<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æˆ‘çš„éš¨èº«è¨˜å¸³</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", Roboto, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        h2 { margin: 0 0 15px 0; color: #333; font-size: 1.2rem;}

        .total-section {
            background: #e3f2fd;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .total-label { font-size: 0.9rem; color: #555; }
        .total-amount { font-size: 2.5rem; color: #1976d2; font-weight: bold; margin: 5px 0; }

        input[type="number"] {
            width: 100%;
            padding: 15px;
            font-size: 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            box-sizing: border-box;
            outline: none;
            -moz-appearance: textfield; /* Firefox */
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input:focus { border-color: #2196f3; }

        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px;
            font-size: 1.1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background-color: #2196f3;
            color: white;
            font-weight: 500;
            touch-action: manipulation; /* å„ªåŒ–è§¸æ§ */
        }
        .btn:active { background-color: #1565c0; transform: scale(0.96); }

        .action-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .btn-small {
            padding: 8px 15px;
            font-size: 0.9rem;
            border-radius: 6px;
            border: none;
            cursor: pointer;
        }
        .btn-danger { background-color: #ffcdd2; color: #c62828; }
        .btn-success { background-color: #c8e6c9; color: #2e7d32; }

        .log-list {
            list-style: none;
            padding: 0;
            margin-top: 10px;
            text-align: left;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-item {
            padding: 12px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .log-info { display: flex; flex-direction: column; }
        .log-time { font-size: 0.75rem; color: #999; margin-bottom: 2px;}
        .log-cat { font-weight: bold; color: #444; }
        .log-money { font-weight: bold; color: #2c3e50; font-size: 1.1rem; }
    </style>
</head>
<body>

<div class="container">
    <h2>ä»Šæ—¥æ¶ˆè²»</h2>
    
    <div class="total-section">
        <div class="total-label">ç›®å‰ç¸½è¨ˆ</div>
        <div class="total-amount">$<span id="totalMoney">0</span></div>
    </div>

    <input type="number" id="amountInput" placeholder="è¼¸å…¥é‡‘é¡" inputmode="decimal">

    <div class="button-grid">
        <button class="btn" onclick="addRecord('æ—©é¤')">æ—©é¤</button>
        <button class="btn" onclick="addRecord('åˆé¤')">åˆé¤</button>
        <button class="btn" onclick="addRecord('å’–å•¡')">å’–å•¡</button>
        <button class="btn" onclick="addRecord('æ™šé¤')">æ™šé¤</button>
        <button class="btn" style="background-color: #7e57c2;" onclick="addRecord('é›œæ”¯')">é›œæ”¯</button>
        <button class="btn" style="background-color: #7e57c2;" onclick="addRecord('äº¤é€š')">äº¤é€š</button>
    </div>

    <div class="action-bar">
        <button class="btn-small btn-danger" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©º</button>
        <button class="btn-small btn-success" onclick="exportCSV()">ğŸ“¥ ä¸‹è¼‰ CSV</button>
    </div>

    <ul class="log-list" id="logList"></ul>
</div>

<script>
    let records = [];
    const totalEl = document.getElementById('totalMoney');
    const inputEl = document.getElementById('amountInput');
    const listEl = document.getElementById('logList');

    // 1. åˆå§‹åŒ–ï¼šæ‰“é–‹ç¶²é æ™‚ï¼Œè®€å–èˆŠè³‡æ–™
    window.onload = function() {
        const savedData = localStorage.getItem('myMoneyRecords');
        if (savedData) {
            records = JSON.parse(savedData);
            render();
        }
    };

    function addRecord(category) {
        const amount = parseInt(inputEl.value);
        if (isNaN(amount) || amount <= 0) {
            alert("è«‹è¼¸å…¥é‡‘é¡ï¼");
            return;
        }

        // å»ºç«‹è³‡æ–™ç‰©ä»¶
        const now = new Date();
        const newRecord = {
            id: Date.now(), // å”¯ä¸€ID
            timestamp: now.toLocaleString(), // å®Œæ•´æ™‚é–“æ ¼å¼
            timeDisplay: `${now.getHours()}:${now.getMinutes().toString().padStart(2, '0')}`,
            category: category,
            amount: amount
        };

        // åŠ å…¥é™£åˆ—ä¸¦å„²å­˜
        records.unshift(newRecord); // åŠ åˆ°æœ€å‰é¢
        saveAndRender();
        
        inputEl.value = '';
        inputEl.focus();
    }

    function saveAndRender() {
        // å­˜å…¥ localStorage
        localStorage.setItem('myMoneyRecords', JSON.stringify(records));
        render();
    }

    function render() {
        // è¨ˆç®—ç¸½å’Œ
        const total = records.reduce((sum, r) => sum + r.amount, 0);
        totalEl.textContent = total;

        // ç¹ªè£½åˆ—è¡¨
        listEl.innerHTML = '';
        records.forEach(r => {
            const li = document.createElement('li');
            li.className = 'log-item';
            li.innerHTML = `
                <div class="log-info">
                    <span class="log-time">${r.timestamp}</span>
                    <span class="log-cat">${r.category}</span>
                </div>
                <span class="log-money">$${r.amount}</span>
            `;
            listEl.appendChild(li);
        });
    }

    function clearData() {
        if(confirm("ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ç´€éŒ„å—ï¼Ÿ")) {
            records = [];
            saveAndRender();
        }
    }

    function exportCSV() {
        if(records.length === 0) {
            alert("æ²’æœ‰è³‡æ–™å¯ä»¥åŒ¯å‡º");
            return;
        }
        let csvContent = "data:text/csv;charset=utf-8,\uFEFF"; // BOM for Excel
        csvContent += "æ™‚é–“,é …ç›®,é‡‘é¡\n";
        
        records.forEach(function(row) {
            csvContent += `${row.timestamp},${row.category},${row.amount}\n`;
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "my_money_log.csv");
        document.body.appendChild(link);
        link.click();
    }
</script>

</body>
</html>
